{
	"cases": [
		{
			"note": "refheads/general, single var",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r := i if q := [\"a\", \"b\", \"c\"][i]\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"r": 0
						},
						"b": {
							"r": 1
						},
						"c": {
							"r": 2
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 21,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 21,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 16,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 16,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 8
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 16,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"r": 0
						},
						"b": {
							"r": 1
						},
						"c": {
							"r": 2
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, multiple vars",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q][r] if q := [\"a\", \"b\", \"c\"][r]\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"0": true
						},
						"b": {
							"1": true
						},
						"c": {
							"2": true
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 17,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 17,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 12,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 12,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 8
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "bool",
																	"value": true
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 12,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"0": true
						},
						"b": {
							"1": true
						},
						"c": {
							"2": true
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, deep query",
			"query": "data.test.p.b = x",
			"modules": [
				"package test\n\np[q][r] if q := [\"a\", \"b\", \"c\"][r]\n"
			],
			"want_result": [
				{
					"x": {
						"1": true
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 17,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 17,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 17,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 12,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 12,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 8
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "bool",
																	"value": true
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 12,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"0": true
						},
						"b": {
							"1": true
						},
						"c": {
							"2": true
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, overlapping rule, no conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r := i if q := [\"a\", \"b\", \"c\"][i]\n\np.a.r := 0\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"r": 0
						},
						"b": {
							"r": 1
						},
						"c": {
							"r": 2
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 21,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 21,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 21,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 16,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 16,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 8
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 16,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 6,
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 2
																						},
																						"row": 5,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 5
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 5
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 5,
												"row": 5,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 2
												},
												"object": 2,
												"row": 5,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "0"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"r": 0
						},
						"b": {
							"r": 1
						},
						"c": {
							"r": 2
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, overlapping rule, different dynamic depths, no conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r.s := i if q := [\"a\", \"b\", \"c\"][i]\n\np.d.r := 3\n\np.e := 4\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"r": {
								"s": 0
							}
						},
						"b": {
							"r": {
								"s": 1
							}
						},
						"c": {
							"r": {
								"s": 2
							}
						},
						"d": {
							"r": 3
						},
						"e": 4
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 23,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 23,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "string_index",
																											"value": 5
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 10
																										},
																										"target": 11
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 11
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 6
																},
																"object": 11,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 8
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 11
																}
															},
															"type": "ObjectInsertStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 18,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 7,
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 8
																						},
																						"row": 5,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 5
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 5
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 5,
												"row": 5,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 8
												},
												"object": 2,
												"row": 5,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 7,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 9,
												"col": 1,
												"file": 0,
												"row": 7,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 10
												},
												"object": 2,
												"row": 7,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 11
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "3"
						},
						{
							"value": "d"
						},
						{
							"value": "4"
						},
						{
							"value": "e"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"r": {
								"s": 0
							}
						},
						"b": {
							"r": {
								"s": 1
							}
						},
						"c": {
							"r": {
								"s": 2
							}
						},
						"d": {
							"r": 3
						},
						"e": 4
					}
				}
			}
		},
		{
			"note": "refheads/general, self-conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r.s := i if q := [\"a\", \"b\", \"c\", \"b\"][i]\n"
			],
			"want_error_code": "eval_conflict_error",
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 23,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "string_index",
																											"value": 5
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 10
																										},
																										"target": 11
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 11
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 6
																},
																"object": 11,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 8
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 11
																}
															},
															"type": "ObjectInsertStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 18,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": null
		},
		{
			"note": "refheads/general, overlapping rule, conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r.s := i if q := [\"a\", \"b\", \"c\"][i]\n\np.a.r := 42\n"
			],
			"want_error_code": "eval_conflict_error",
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 23,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 23,
												"file": 0,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 23,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 18,
																"file": 0,
																"row": 3,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 9
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "string_index",
																											"value": 5
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 10
																										},
																										"target": 11
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 11
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 6
																},
																"object": 11,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 8
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 10,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 11
																}
															},
															"type": "ObjectInsertStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 9
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 18,
												"file": 0,
												"key": 6,
												"row": 3,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 7,
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 2
																						},
																						"row": 5,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 5
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 5
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 5,
												"row": 5,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 2
												},
												"object": 2,
												"row": 5,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 8
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "42"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": null
		},
		{
			"note": "refheads/general, overlapping rule, deep override inside other rule object value, conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r := v if {\n\tq := \"q\"\n\tv := {\"s\": {\"t\": 1}}\n}\n\np.q.r.s.t := 42\n"
			],
			"want_error_code": "eval_conflict_error",
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 8,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 2,
												"col": 1,
												"file": 0,
												"row": 8,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 3
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 4
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 5
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 6
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 6
																						},
																						"target": 7
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 7
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 6
												},
												"object": 7,
												"row": 8,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 6,
												"row": 8,
												"value": {
													"type": "local",
													"value": 7
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"object": 5,
												"row": 8,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 8,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 4,
												"source": {
													"type": "string_index",
													"value": 3
												},
												"target": 4
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 5
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 6
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"Index": 7,
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 7
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 6
												},
												"object": 6,
												"row": 5,
												"value": {
													"type": "local",
													"value": 7
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 5,
												"row": 5,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"source": {
													"type": "local",
													"value": 5
												},
												"target": 8
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "local",
																							"value": 4
																						},
																						"row": 3,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 9
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 3
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 9
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 3
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"object": 9,
												"row": 3,
												"value": {
													"type": "local",
													"value": 8
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"row": 3,
												"value": {
													"type": "local",
													"value": 9
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 8
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "42"
						},
						{
							"value": "q"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "t"
						},
						{
							"value": "1"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": null
		},
		{
			"note": "refheads/general, overlapping rule, deep injection into other rule object value, conflict",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r := v if {\n\tq := \"q\"\n\tv := {\"s\": {\"t\": 1}}\n}\n\np.q.r.s.u := 42\n"
			],
			"want_error_code": "eval_conflict_error",
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 8,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"Index": 2,
												"col": 1,
												"file": 0,
												"row": 8,
												"target": 4
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 3
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 4
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 5
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 6
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 8,
																						"source": {
																							"type": "local",
																							"value": 6
																						},
																						"target": 7
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 8
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 7
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 8
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 6
												},
												"object": 7,
												"row": 8,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 6,
												"row": 8,
												"value": {
													"type": "local",
													"value": 7
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"object": 5,
												"row": 8,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 8,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 4,
												"source": {
													"type": "string_index",
													"value": 3
												},
												"target": 4
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 5
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 6
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"Index": 8,
												"col": 2,
												"file": 0,
												"row": 5,
												"target": 7
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 7
												},
												"object": 6,
												"row": 5,
												"value": {
													"type": "local",
													"value": 7
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 5,
												"row": 5,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 5,
												"source": {
													"type": "local",
													"value": 5
												},
												"target": 8
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "local",
																							"value": 4
																						},
																						"row": 3,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 9
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 3
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 9
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 3
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"object": 9,
												"row": 3,
												"value": {
													"type": "local",
													"value": 8
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"row": 3,
												"value": {
													"type": "local",
													"value": 9
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 9
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "42"
						},
						{
							"value": "q"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "u"
						},
						{
							"value": "t"
						},
						{
							"value": "1"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": null
		},
		{
			"note": "refheads/general, set leaf (shallow ref)",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q] contains r if {\n\tx := [\"a\", \"b\", \"c\"]\n\tq := x[_]\n\tr := x[_]\n\tq != r\n}\n\np.b contains \"foo\"\n"
			],
			"want_result": [
				{
					"x": {
						"a": [
							"b",
							"c"
						],
						"b": [
							"a",
							"c",
							"foo"
						],
						"c": [
							"a",
							"b"
						]
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 2,
												"file": 0,
												"row": 4,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 4,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"block": {
																	"stmts": [
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 10
																				},
																				"target": 12
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 11
																				},
																				"target": 13
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"args": [
																					{
																						"type": "local",
																						"value": 9
																					},
																					{
																						"type": "local",
																						"value": 13
																					}
																				],
																				"col": 2,
																				"file": 0,
																				"func": "neq",
																				"result": 14,
																				"row": 7
																			},
																			"type": "CallStmt"
																		},
																		{
																			"stmt": {
																				"a": {
																					"type": "local",
																					"value": 14
																				},
																				"b": {
																					"type": "bool",
																					"value": false
																				},
																				"col": 2,
																				"file": 0,
																				"row": 7
																			},
																			"type": "NotEqualStmt"
																		},
																		{
																			"stmt": {
																				"blocks": [
																					{
																						"stmts": [
																							{
																								"stmt": {
																									"blocks": [
																										{
																											"stmts": [
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"key": {
																															"type": "local",
																															"value": 9
																														},
																														"row": 3,
																														"source": {
																															"type": "local",
																															"value": 2
																														},
																														"target": 15
																													},
																													"type": "DotStmt"
																												},
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"index": 1,
																														"row": 3
																													},
																													"type": "BreakStmt"
																												}
																											]
																										}
																									],
																									"col": 0,
																									"file": 0,
																									"row": 0
																								},
																								"type": "BlockStmt"
																							},
																							{
																								"stmt": {
																									"col": 0,
																									"file": 0,
																									"row": 0,
																									"target": 15
																								},
																								"type": "MakeSetStmt"
																							}
																						]
																					}
																				],
																				"col": 1,
																				"file": 0,
																				"row": 3
																			},
																			"type": "BlockStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"row": 3,
																				"set": 15,
																				"value": {
																					"type": "local",
																					"value": 13
																				}
																			},
																			"type": "SetAddStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "local",
																					"value": 9
																				},
																				"object": 2,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 15
																				}
																			},
																			"type": "ObjectInsertStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "local",
																					"value": 9
																				},
																				"object": 2,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 15
																				}
																			},
																			"type": "ObjectInsertStmt"
																		}
																	]
																},
																"col": 2,
																"file": 0,
																"key": 10,
																"row": 6,
																"source": 5,
																"value": 11
															},
															"type": "ScanStmt"
														}
													]
												},
												"col": 2,
												"file": 0,
												"key": 6,
												"row": 5,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 3
																						},
																						"row": 10,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 4
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 10
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 4
																},
																"type": "MakeSetStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 10
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"set": 4,
												"value": {
													"type": "string_index",
													"value": 5
												}
											},
											"type": "SetAddStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 10,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 10,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"builtin_funcs": [
						{
							"decl": {
								"args": [
									{
										"name": "x",
										"type": "any"
									},
									{
										"name": "y",
										"type": "any"
									}
								],
								"result": {
									"description": "true if `x` is not equal to `y`; false otherwise",
									"name": "result",
									"type": "boolean"
								},
								"type": "function"
							},
							"name": "neq"
						}
					],
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "foo"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": [
							"b",
							"c"
						],
						"b": [
							"a",
							"c",
							"foo"
						],
						"c": [
							"a",
							"b"
						]
					}
				}
			}
		},
		{
			"note": "refheads/general, set leaf (other rule defines dynamic ref portion)",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np.q contains r if {\n    r := [\"a\", \"b\", \"c\"][_]\n}\n\np[q] := r if {\n    q := \"foo\"\n    r := \"bar\"\n}\n"
			],
			"want_result": [
				{
					"x": {
						"foo": "bar",
						"q": [
							"a",
							"b",
							"c"
						]
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 10,
												"file": 0,
												"row": 4,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 10,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 10,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 10,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 10,
												"file": 0,
												"row": 4,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 5,
																"file": 0,
																"row": 4,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 5,
																"file": 0,
																"row": 4,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "string_index",
																											"value": 5
																										},
																										"row": 3,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 10
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 3
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 10
																				},
																				"type": "MakeSetStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 3
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"row": 3,
																"set": 10,
																"value": {
																	"type": "local",
																	"value": 9
																}
															},
															"type": "SetAddStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"object": 2,
																"row": 3,
																"value": {
																	"type": "local",
																	"value": 10
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 5,
												"file": 0,
												"key": 6,
												"row": 4,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 7,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 5,
												"file": 0,
												"row": 8,
												"source": {
													"type": "string_index",
													"value": 6
												},
												"target": 4
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 5,
												"file": 0,
												"row": 9,
												"source": {
													"type": "string_index",
													"value": 7
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"row": 7,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 8
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "q"
						},
						{
							"value": "foo"
						},
						{
							"value": "bar"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"foo": "bar",
						"q": [
							"a",
							"b",
							"c"
						]
					}
				}
			}
		},
		{
			"note": "refheads/general, set leaf",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[q].r contains s if {\n\tx := [\"a\", \"b\", \"c\"]\n\tq := x[_]\n\ts := x[_]\n\tq != s\n}\n\np.b.r contains \"foo\"\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"r": [
								"b",
								"c"
							]
						},
						"b": {
							"r": [
								"a",
								"c",
								"foo"
							]
						},
						"c": {
							"r": [
								"a",
								"b"
							]
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 2,
												"file": 0,
												"row": 4,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 4,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"block": {
																	"stmts": [
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 10
																				},
																				"target": 12
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 11
																				},
																				"target": 13
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"args": [
																					{
																						"type": "local",
																						"value": 9
																					},
																					{
																						"type": "local",
																						"value": 13
																					}
																				],
																				"col": 2,
																				"file": 0,
																				"func": "neq",
																				"result": 14,
																				"row": 7
																			},
																			"type": "CallStmt"
																		},
																		{
																			"stmt": {
																				"a": {
																					"type": "local",
																					"value": 14
																				},
																				"b": {
																					"type": "bool",
																					"value": false
																				},
																				"col": 2,
																				"file": 0,
																				"row": 7
																			},
																			"type": "NotEqualStmt"
																		},
																		{
																			"stmt": {
																				"blocks": [
																					{
																						"stmts": [
																							{
																								"stmt": {
																									"blocks": [
																										{
																											"stmts": [
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"key": {
																															"type": "local",
																															"value": 9
																														},
																														"row": 3,
																														"source": {
																															"type": "local",
																															"value": 2
																														},
																														"target": 15
																													},
																													"type": "DotStmt"
																												},
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"index": 1,
																														"row": 3
																													},
																													"type": "BreakStmt"
																												}
																											]
																										}
																									],
																									"col": 0,
																									"file": 0,
																									"row": 0
																								},
																								"type": "BlockStmt"
																							},
																							{
																								"stmt": {
																									"col": 0,
																									"file": 0,
																									"row": 0,
																									"target": 15
																								},
																								"type": "MakeObjectStmt"
																							}
																						]
																					}
																				],
																				"col": 1,
																				"file": 0,
																				"row": 3
																			},
																			"type": "BlockStmt"
																		},
																		{
																			"stmt": {
																				"blocks": [
																					{
																						"stmts": [
																							{
																								"stmt": {
																									"blocks": [
																										{
																											"stmts": [
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"key": {
																															"type": "string_index",
																															"value": 5
																														},
																														"row": 3,
																														"source": {
																															"type": "local",
																															"value": 15
																														},
																														"target": 16
																													},
																													"type": "DotStmt"
																												},
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"index": 1,
																														"row": 3
																													},
																													"type": "BreakStmt"
																												}
																											]
																										}
																									],
																									"col": 0,
																									"file": 0,
																									"row": 0
																								},
																								"type": "BlockStmt"
																							},
																							{
																								"stmt": {
																									"col": 0,
																									"file": 0,
																									"row": 0,
																									"target": 16
																								},
																								"type": "MakeSetStmt"
																							}
																						]
																					}
																				],
																				"col": 1,
																				"file": 0,
																				"row": 3
																			},
																			"type": "BlockStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"row": 3,
																				"set": 16,
																				"value": {
																					"type": "local",
																					"value": 13
																				}
																			},
																			"type": "SetAddStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "string_index",
																					"value": 5
																				},
																				"object": 15,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 16
																				}
																			},
																			"type": "ObjectInsertStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "string_index",
																					"value": 5
																				},
																				"object": 15,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 16
																				}
																			},
																			"type": "ObjectInsertStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "local",
																					"value": 9
																				},
																				"object": 2,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 15
																				}
																			},
																			"type": "ObjectInsertStmt"
																		}
																	]
																},
																"col": 2,
																"file": 0,
																"key": 10,
																"row": 6,
																"source": 5,
																"value": 11
															},
															"type": "ScanStmt"
														}
													]
												},
												"col": 2,
												"file": 0,
												"key": 6,
												"row": 5,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 3
																						},
																						"row": 10,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 4
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 10
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 4
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 10
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 10,
																						"source": {
																							"type": "local",
																							"value": 4
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 10
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeSetStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 10
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"set": 5,
												"value": {
													"type": "string_index",
													"value": 6
												}
											},
											"type": "SetAddStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 4,
												"row": 10,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 4,
												"row": 10,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 10,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"builtin_funcs": [
						{
							"decl": {
								"args": [
									{
										"name": "x",
										"type": "any"
									},
									{
										"name": "y",
										"type": "any"
									}
								],
								"result": {
									"description": "true if `x` is not equal to `y`; false otherwise",
									"name": "result",
									"type": "boolean"
								},
								"type": "function"
							},
							"name": "neq"
						}
					],
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "foo"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"r": [
								"b",
								"c"
							]
						},
						"b": {
							"r": [
								"a",
								"c",
								"foo"
							]
						},
						"c": {
							"r": [
								"a",
								"b"
							]
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, set leaf, deep query",
			"query": "data.test.p.b.r.c = x",
			"modules": [
				"package test\n\np[q].r contains s if {\n\tx := [\"a\", \"b\", \"c\"]\n\tq := x[_]\n\ts := x[_]\n\tq != s\n}\n\np.b.r contains \"foo\"\n"
			],
			"want_result": [
				{
					"x": "c"
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 3,
												"col": 2,
												"file": 0,
												"row": 4,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 2
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"array": 4,
												"col": 2,
												"file": 0,
												"row": 4,
												"value": {
													"type": "string_index",
													"value": 4
												}
											},
											"type": "ArrayAppendStmt"
										},
										{
											"stmt": {
												"col": 2,
												"file": 0,
												"row": 4,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 5,
																"source": {
																	"type": "local",
																	"value": 7
																},
																"target": 9
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"block": {
																	"stmts": [
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 10
																				},
																				"target": 12
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"col": 2,
																				"file": 0,
																				"row": 6,
																				"source": {
																					"type": "local",
																					"value": 11
																				},
																				"target": 13
																			},
																			"type": "AssignVarStmt"
																		},
																		{
																			"stmt": {
																				"args": [
																					{
																						"type": "local",
																						"value": 9
																					},
																					{
																						"type": "local",
																						"value": 13
																					}
																				],
																				"col": 2,
																				"file": 0,
																				"func": "neq",
																				"result": 14,
																				"row": 7
																			},
																			"type": "CallStmt"
																		},
																		{
																			"stmt": {
																				"a": {
																					"type": "local",
																					"value": 14
																				},
																				"b": {
																					"type": "bool",
																					"value": false
																				},
																				"col": 2,
																				"file": 0,
																				"row": 7
																			},
																			"type": "NotEqualStmt"
																		},
																		{
																			"stmt": {
																				"blocks": [
																					{
																						"stmts": [
																							{
																								"stmt": {
																									"blocks": [
																										{
																											"stmts": [
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"key": {
																															"type": "local",
																															"value": 9
																														},
																														"row": 3,
																														"source": {
																															"type": "local",
																															"value": 2
																														},
																														"target": 15
																													},
																													"type": "DotStmt"
																												},
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"index": 1,
																														"row": 3
																													},
																													"type": "BreakStmt"
																												}
																											]
																										}
																									],
																									"col": 0,
																									"file": 0,
																									"row": 0
																								},
																								"type": "BlockStmt"
																							},
																							{
																								"stmt": {
																									"col": 0,
																									"file": 0,
																									"row": 0,
																									"target": 15
																								},
																								"type": "MakeObjectStmt"
																							}
																						]
																					}
																				],
																				"col": 1,
																				"file": 0,
																				"row": 3
																			},
																			"type": "BlockStmt"
																		},
																		{
																			"stmt": {
																				"blocks": [
																					{
																						"stmts": [
																							{
																								"stmt": {
																									"blocks": [
																										{
																											"stmts": [
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"key": {
																															"type": "string_index",
																															"value": 5
																														},
																														"row": 3,
																														"source": {
																															"type": "local",
																															"value": 15
																														},
																														"target": 16
																													},
																													"type": "DotStmt"
																												},
																												{
																													"stmt": {
																														"col": 1,
																														"file": 0,
																														"index": 1,
																														"row": 3
																													},
																													"type": "BreakStmt"
																												}
																											]
																										}
																									],
																									"col": 0,
																									"file": 0,
																									"row": 0
																								},
																								"type": "BlockStmt"
																							},
																							{
																								"stmt": {
																									"col": 0,
																									"file": 0,
																									"row": 0,
																									"target": 16
																								},
																								"type": "MakeSetStmt"
																							}
																						]
																					}
																				],
																				"col": 1,
																				"file": 0,
																				"row": 3
																			},
																			"type": "BlockStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"row": 3,
																				"set": 16,
																				"value": {
																					"type": "local",
																					"value": 13
																				}
																			},
																			"type": "SetAddStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "string_index",
																					"value": 5
																				},
																				"object": 15,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 16
																				}
																			},
																			"type": "ObjectInsertStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "string_index",
																					"value": 5
																				},
																				"object": 15,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 16
																				}
																			},
																			"type": "ObjectInsertStmt"
																		},
																		{
																			"stmt": {
																				"col": 1,
																				"file": 0,
																				"key": {
																					"type": "local",
																					"value": 9
																				},
																				"object": 2,
																				"row": 3,
																				"value": {
																					"type": "local",
																					"value": 15
																				}
																			},
																			"type": "ObjectInsertStmt"
																		}
																	]
																},
																"col": 2,
																"file": 0,
																"key": 10,
																"row": 6,
																"source": 5,
																"value": 11
															},
															"type": "ScanStmt"
														}
													]
												},
												"col": 2,
												"file": 0,
												"key": 6,
												"row": 5,
												"source": 5,
												"value": 7
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 3
																						},
																						"row": 10,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 4
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 10
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 4
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 10
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 10,
																						"source": {
																							"type": "local",
																							"value": 4
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 10
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 5
																},
																"type": "MakeSetStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 10
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 10,
												"set": 5,
												"value": {
													"type": "string_index",
													"value": 6
												}
											},
											"type": "SetAddStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 4,
												"row": 10,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 4,
												"row": 10,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 3
												},
												"object": 2,
												"row": 10,
												"value": {
													"type": "local",
													"value": 4
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"builtin_funcs": [
						{
							"decl": {
								"args": [
									{
										"name": "x",
										"type": "any"
									},
									{
										"name": "y",
										"type": "any"
									}
								],
								"result": {
									"description": "true if `x` is not equal to `y`; false otherwise",
									"name": "result",
									"type": "boolean"
								},
								"type": "function"
							},
							"name": "neq"
						}
					],
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "r"
						},
						{
							"value": "foo"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"a": {
							"r": [
								"b",
								"c"
							]
						},
						"b": {
							"r": [
								"a",
								"c",
								"foo"
							]
						},
						"c": {
							"r": [
								"a",
								"b"
							]
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, input var",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[input.x].r := \"foo\"\n"
			],
			"input": {
				"x": "bar"
			},
			"want_result": [
				{
					"x": {
						"bar": {
							"r": "foo"
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 3,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 2
												},
												"row": 3,
												"source": {
													"type": "local",
													"value": 0
												},
												"target": 4
											},
											"type": "DotStmt"
										},
										{
											"stmt": {
												"col": 3,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "local",
																							"value": 5
																						},
																						"row": 3,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 3
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 6
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 3
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"object": 6,
												"row": 3,
												"value": {
													"type": "string_index",
													"value": 3
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 5
												},
												"object": 2,
												"row": 3,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 5
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 5,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 4
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 6
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 7
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 7,
												"row": 0,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 7
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "x"
						},
						{
							"value": "foo"
						},
						{
							"value": "r"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"bar": {
							"r": "foo"
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, external non-ground var",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\na := [x | x := input.x[_]]\n\nb := input.y\n\np[a[b]].r[s] := i if {\n\ts := a[i]\n}\n"
			],
			"input": {
				"x": [
					"foo",
					"bar",
					"baz"
				],
				"y": 1
			},
			"want_result": [
				{
					"x": {
						"bar": {
							"r": {
								"bar": 1,
								"baz": 2,
								"foo": 0
							}
						}
					}
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"capacity": 0,
												"col": 6,
												"file": 0,
												"row": 3,
												"target": 4
											},
											"type": "MakeArrayStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"col": 11,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 2
																	},
																	"row": 3,
																	"source": {
																		"type": "local",
																		"value": 0
																	},
																	"target": 5
																},
																"type": "DotStmt"
															},
															{
																"stmt": {
																	"block": {
																		"stmts": [
																			{
																				"stmt": {
																					"col": 11,
																					"file": 0,
																					"row": 3,
																					"source": {
																						"type": "local",
																						"value": 6
																					},
																					"target": 8
																				},
																				"type": "AssignVarStmt"
																			},
																			{
																				"stmt": {
																					"col": 11,
																					"file": 0,
																					"row": 3,
																					"source": {
																						"type": "local",
																						"value": 7
																					},
																					"target": 9
																				},
																				"type": "AssignVarStmt"
																			},
																			{
																				"stmt": {
																					"array": 4,
																					"col": 6,
																					"file": 0,
																					"row": 3,
																					"value": {
																						"type": "local",
																						"value": 9
																					}
																				},
																				"type": "ArrayAppendStmt"
																			}
																		]
																	},
																	"col": 11,
																	"file": 0,
																	"key": 6,
																	"row": 3,
																	"source": 5,
																	"value": 7
																},
																"type": "ScanStmt"
															}
														]
													}
												],
												"col": 6,
												"file": 0,
												"row": 3
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 6,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 10
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 10
												},
												"target": 3
											},
											"type": "AssignVarOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 3
											},
											"type": "IsDefinedStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2
											},
											"type": "AssignVarOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.a",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"a"
							],
							"return": 2
						},
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 6,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 4
												},
												"row": 5,
												"source": {
													"type": "local",
													"value": 0
												},
												"target": 4
											},
											"type": "DotStmt"
										},
										{
											"stmt": {
												"col": 6,
												"file": 0,
												"row": 5,
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 5
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"source": {
													"type": "local",
													"value": 5
												},
												"target": 3
											},
											"type": "AssignVarOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"source": 3
											},
											"type": "IsDefinedStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2
											},
											"type": "AssignVarOnceStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.b",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"b"
							],
							"return": 2
						},
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 7,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 7,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"col": 2,
												"file": 0,
												"func": "g0.data.test.a",
												"result": 4,
												"row": 8
											},
											"type": "CallStmt"
										},
										{
											"stmt": {
												"block": {
													"stmts": [
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 8,
																"source": {
																	"type": "local",
																	"value": 5
																},
																"target": 7
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"col": 2,
																"file": 0,
																"row": 8,
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"args": [
																	{
																		"type": "local",
																		"value": 0
																	},
																	{
																		"type": "local",
																		"value": 1
																	}
																],
																"col": 5,
																"file": 0,
																"func": "g0.data.test.b",
																"result": 9,
																"row": 7
															},
															"type": "CallStmt"
														},
														{
															"stmt": {
																"col": 5,
																"file": 0,
																"row": 7,
																"source": {
																	"type": "local",
																	"value": 9
																},
																"target": 10
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"args": [
																	{
																		"type": "local",
																		"value": 0
																	},
																	{
																		"type": "local",
																		"value": 1
																	}
																],
																"col": 3,
																"file": 0,
																"func": "g0.data.test.a",
																"result": 11,
																"row": 7
															},
															"type": "CallStmt"
														},
														{
															"stmt": {
																"col": 3,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 10
																},
																"row": 7,
																"source": {
																	"type": "local",
																	"value": 11
																},
																"target": 12
															},
															"type": "DotStmt"
														},
														{
															"stmt": {
																"col": 3,
																"file": 0,
																"row": 7,
																"source": {
																	"type": "local",
																	"value": 12
																},
																"target": 13
															},
															"type": "AssignVarStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "local",
																											"value": 13
																										},
																										"row": 7,
																										"source": {
																											"type": "local",
																											"value": 2
																										},
																										"target": 14
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 7
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 14
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 7
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"blocks": [
																	{
																		"stmts": [
																			{
																				"stmt": {
																					"blocks": [
																						{
																							"stmts": [
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"key": {
																											"type": "string_index",
																											"value": 6
																										},
																										"row": 7,
																										"source": {
																											"type": "local",
																											"value": 14
																										},
																										"target": 15
																									},
																									"type": "DotStmt"
																								},
																								{
																									"stmt": {
																										"col": 1,
																										"file": 0,
																										"index": 1,
																										"row": 7
																									},
																									"type": "BreakStmt"
																								}
																							]
																						}
																					],
																					"col": 0,
																					"file": 0,
																					"row": 0
																				},
																				"type": "BlockStmt"
																			},
																			{
																				"stmt": {
																					"col": 0,
																					"file": 0,
																					"row": 0,
																					"target": 15
																				},
																				"type": "MakeObjectStmt"
																			}
																		]
																	}
																],
																"col": 1,
																"file": 0,
																"row": 7
															},
															"type": "BlockStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 8
																},
																"object": 15,
																"row": 7,
																"value": {
																	"type": "local",
																	"value": 7
																}
															},
															"type": "ObjectInsertOnceStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "string_index",
																	"value": 6
																},
																"object": 14,
																"row": 7,
																"value": {
																	"type": "local",
																	"value": 15
																}
															},
															"type": "ObjectInsertStmt"
														},
														{
															"stmt": {
																"col": 1,
																"file": 0,
																"key": {
																	"type": "local",
																	"value": 13
																},
																"object": 2,
																"row": 7,
																"value": {
																	"type": "local",
																	"value": 14
																}
															},
															"type": "ObjectInsertStmt"
														}
													]
												},
												"col": 2,
												"file": 0,
												"key": 5,
												"row": 8,
												"source": 4,
												"value": 6
											},
											"type": "ScanStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 7,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.a",
																	"result": 3,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 3
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.b",
																	"result": 4,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 3
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 4
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p",
																	"result": 5,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 5
																	},
																	"object": 2,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 5
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 7
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 7,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 6
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 6
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 6
												},
												"target": 8
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 9
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 9,
												"row": 0,
												"value": {
													"type": "local",
													"value": 8
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 9
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "a"
						},
						{
							"value": "x"
						},
						{
							"value": "b"
						},
						{
							"value": "y"
						},
						{
							"value": "p"
						},
						{
							"value": "r"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"a": [
						"foo",
						"bar",
						"baz"
					],
					"b": 1,
					"p": {
						"bar": {
							"r": {
								"bar": 1,
								"baz": 2,
								"foo": 0
							}
						}
					}
				}
			}
		},
		{
			"note": "refheads/general, multiple result-set entries",
			"query": "data.test.p.q[i].s = x",
			"modules": [
				"package test\n\np.q[r].s := 1 if r := \"foo\"\n\np.q[r].s := 2 if r := \"bar\"\n"
			],
			"want_result": [
				{
					"i": "foo",
					"x": 1
				},
				{
					"i": "bar",
					"x": 2
				}
			],
			"entrypoints": [
				"test"
			],
			"plan": {
				"funcs": {
					"funcs": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 2
											},
											"type": "MakeObjectStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 18,
												"file": 0,
												"row": 3,
												"source": {
													"type": "string_index",
													"value": 3
												},
												"target": 4
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"Index": 4,
												"col": 1,
												"file": 0,
												"row": 3,
												"target": 5
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "local",
																							"value": 4
																						},
																						"row": 3,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 3
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 6
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 3
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 6,
												"row": 3,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"row": 3,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 3
											},
											"type": "ResetLocalStmt"
										},
										{
											"stmt": {
												"col": 18,
												"file": 0,
												"row": 5,
												"source": {
													"type": "string_index",
													"value": 6
												},
												"target": 4
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"Index": 7,
												"col": 1,
												"file": 0,
												"row": 5,
												"target": 5
											},
											"type": "MakeNumberRefStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"key": {
																							"type": "local",
																							"value": 4
																						},
																						"row": 5,
																						"source": {
																							"type": "local",
																							"value": 2
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"col": 1,
																						"file": 0,
																						"index": 1,
																						"row": 5
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"target": 6
																},
																"type": "MakeObjectStmt"
															}
														]
													}
												],
												"col": 1,
												"file": 0,
												"row": 5
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 5
												},
												"object": 6,
												"row": 5,
												"value": {
													"type": "local",
													"value": 5
												}
											},
											"type": "ObjectInsertOnceStmt"
										},
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"key": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"row": 5,
												"value": {
													"type": "local",
													"value": 6
												}
											},
											"type": "ObjectInsertStmt"
										}
									]
								},
								{
									"stmts": [
										{
											"stmt": {
												"col": 1,
												"file": 0,
												"row": 3,
												"source": 2
											},
											"type": "ReturnLocalStmt"
										}
									]
								}
							],
							"name": "g0.data.test.p.q",
							"params": [
								0,
								1
							],
							"path": [
								"g0",
								"test",
								"p",
								"q"
							],
							"return": 2
						}
					]
				},
				"plans": {
					"plans": [
						{
							"blocks": [
								{
									"stmts": [
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 2
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 3
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"func": "g0.data.test.p.q",
																	"result": 4,
																	"row": 0
																},
																"type": "CallStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"key": {
																		"type": "string_index",
																		"value": 2
																	},
																	"object": 3,
																	"row": 0,
																	"value": {
																		"type": "local",
																		"value": 4
																	}
																},
																"type": "ObjectInsertStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 1
												},
												"object": 2,
												"row": 0,
												"value": {
													"type": "local",
													"value": 3
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"key": {
																							"type": "string_index",
																							"value": 8
																						},
																						"row": 0,
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"target": 6
																					},
																					"type": "DotStmt"
																				},
																				{
																					"stmt": {
																						"a": 6,
																						"b": 2,
																						"col": 0,
																						"file": 0,
																						"row": 0,
																						"target": 5
																					},
																					"type": "ObjectMergeStmt"
																				},
																				{
																					"stmt": {
																						"col": 0,
																						"file": 0,
																						"index": 1,
																						"row": 0
																					},
																					"type": "BreakStmt"
																				}
																			]
																		}
																	],
																	"col": 0,
																	"file": 0,
																	"row": 0
																},
																"type": "BlockStmt"
															},
															{
																"stmt": {
																	"col": 0,
																	"file": 0,
																	"row": 0,
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 5
																},
																"type": "AssignVarStmt"
															}
														]
													}
												],
												"col": 0,
												"file": 0,
												"row": 0
											},
											"type": "BlockStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"source": {
													"type": "local",
													"value": 5
												},
												"target": 7
											},
											"type": "AssignVarStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"target": 8
											},
											"type": "MakeObjectStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"key": {
													"type": "string_index",
													"value": 0
												},
												"object": 8,
												"row": 0,
												"value": {
													"type": "local",
													"value": 7
												}
											},
											"type": "ObjectInsertStmt"
										},
										{
											"stmt": {
												"col": 0,
												"file": 0,
												"row": 0,
												"value": 8
											},
											"type": "ResultSetAddStmt"
										}
									]
								}
							],
							"name": "test"
						}
					]
				},
				"static": {
					"files": [
						{
							"value": "mod_0"
						}
					],
					"strings": [
						{
							"value": "result"
						},
						{
							"value": "p"
						},
						{
							"value": "q"
						},
						{
							"value": "foo"
						},
						{
							"value": "1"
						},
						{
							"value": "s"
						},
						{
							"value": "bar"
						},
						{
							"value": "2"
						},
						{
							"value": "test"
						}
					]
				}
			},
			"want_plan_result": {
				"data_test": {
					"p": {
						"q": {
							"bar": {
								"s": 2
							},
							"foo": {
								"s": 1
							}
						}
					}
				}
			}
		}
	]
}